# yt2rss - слушаем YouTube в аудио

## Описание
`yt2rss` - это проект, который позволяет конвертировать поток видео из YouTube канала в RSS фид с аудио-версиями этих выпусков. 
Это упрощает отслеживание новых видео на YouTube через RSS ридеры и позволяет прослушивать их в приложениях для подкастов.

## Функциональность
- Интерфейс - сайт, позволяющий вести списки youtube каналов пользователю или администратору. Пользователь определяется посредством аутентификации через OAuth2(OID) с поддержкой нескольких провайдеров (Github, Яндекс, Google);
- Поддержание актуальности списка эпизодов (роликов) из пользовательских каналов;
- Скачивание роликов и преобразование их в формат аудио;
- Сохранение сформированного аудио в объектном (S3 совместимом) хранилище;
- Формирование RSS(и Atom)-фидов со ссылками на поток сохраненного аудио контента. Использование данных лент предполагается в приложениях работающих с подкастами. 


## Составные части
Разработка состоит из трех (под)сервисов: 
- [y2rss](https://github.com/GePi/yt2rss) - сайт, с помощью которого конечный пользователь ведёт список отслеживаемых каналов 
  - реализует интерфейс позволяющий работать со списком каналов, эпизодов;
  - управляет списком каналов и эпизодов в них:
    - формирует список эпизодов каналов и управляет им (поддерживая актуальность);
    - формирует RSS-фиды с аудио-версиями выпусков для каждого из каналов;
- [y2rss_api](https://github.com/GePi/y2rss_api) - сервис, с доступом к той же БД, что и сайт, предоставляющий API для управления процессом скачивания и преобразования файлов;  
  - `/getFileToDownload` - отдает эпизод из очереди на скачивание;
  - `/putDownloadedFile` - принимает ссылку на скаченный эпизод (обрабатывает журнал скачивания, прописывает ссылку в БД).
- [y2dnl](https://github.com/GePi/y2dnl) - сервис загрузки, преобразования файлов, закачки их в хранилище. Поскольку нагрузка на преобразование видео-аудио может быть значительной, сервис спроектирован таким образом, что одновременно может быть запущено произвольное количество его инстанциий.

Для функционирования требуется инсталляция СУБД Postgree SQL и объектное хранилище [minio](https://min.io/)
(настройка всего функционала см. [y2rss_compose](https://github.com/GePi/y2rss_compose))

## Технологии
Java 17, Postgree SQL(посредством Spring Data JPA), Spring Boot 3.0.6, Docker, Maven, Liquibase, Lombok, jsoup, OAuth2(посредством Spring Security), шаблонизатор Thymeleaf. 

## Сборка и настройка
Для понимания и удобства развертки всего функционала (в т.ч. Postree SQL, minio) создан отдельный репозиторий содержащий файлы docker-compose для каждого из сервисов используемых в проекте.

Репозиторий https://github.com/GePi/y2rss_compose
   
Для настройки базы данных и обеспечения работы приложения необходимо заполнить настройки ряда переменных (секретов).
Полный список этих переменных приведен в файле [.env.sample](src%2Fmain%2Fresources%2Fdocker%2Fdb%2F.env.sample).

Настройки могут быть заданы либо как переменные окружения операционной системы (env), 
либо посредством создания и заполнения файла секретов [.env](src%2Fmain%2Fresources%2Fdocker%2Fdb%2F.env) в корне проекта.

Для обеспечения прозрачного переключения между файлом .env и переменными окружения в проекте 
используется библиотека [me.paulschwarz:spring-dotenv](https://github.com/paulschwarz/spring-dotenv).